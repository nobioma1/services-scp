version: '3.8'

services:
  mongo_db:
      container_name: db_mongo
      image: mongo:7.0
      restart: always
      ports:
        - "27017:27017"
      volumes:
        - ./.docker/db-data:/data/db
      environment:
        MONGO_INITDB_ROOT_USERNAME: ${MONGO_USERNAME}
        MONGO_INITDB_ROOT_PASSWORD: ${MONGO_PASSWORD}
  
  web:
    container_name: web_app
    build: ./apps/web
    volumes:
      - ./apps/web:/app/
      - /app/node_modules
    ports:
      - '3000:3000'

  feedbacks-service: 
    container_name: api_feedbacks
    build: ./services/feedbacks
    volumes:
      - ./services/feedbacks:/app/
      - /app/node_modules
    ports:
      - "8003:8003"
    depends_on:
      - mongo_db
    environment:
      PORT: 8003
      MONGO_URI: "mongodb://${MONGO_USERNAME}:${MONGO_PASSWORD}@mongo_db:27017"
      DB_NAME: feedbacks

volumes:
  db-data:
